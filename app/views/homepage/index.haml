- content_for :javascript do
  initialize_homepage();

- content_for :coverfade_class do
  = "without-text"

- content_for :extra_javascript do
  - # maps.google can't be loaded twice
  - maps_key = MarketplaceHelper.google_maps_key(@current_community.id)
  - key_param = maps_key ? "&key=#{maps_key}" : ""
  - # Topbar adds its own maps script, otherwise add it if location search enabled or map is visible
  - needs_maps = !FeatureFlagHelper.feature_enabled?(:topbar_v1) && (main_search != :keyword || @view_type.eql?("map"))
  - if(needs_maps)
    = javascript_include_tag "//maps.googleapis.com/maps/api/js?libraries=places#{key_param}"
  = javascript_include_tag "markerclusterer.js"

- content_for :title_header do
  - is_homepage = params[:controller] == "homepage" && params[:action] == "index"
  - if @big_cover_photo
    %h1.marketplace-lander-content-title= community_slogan.html_safe
    %p.marketplace-lander-content-description= community_description.html_safe
    - unless (is_homepage && !@current_community.private? && FeatureFlagHelper.feature_enabled?(:topbar_v1))
      .search-form
        - if @current_community.private?
          %a.inline-big-button{href: sign_up_path}
            .content
              = t("layouts.application.connect")
        - else
          - if(main_search == :location)
            = render partial: "location_bar"
          - else
            = render partial: "search_bar"
  - elsif !(is_homepage && FeatureFlagHelper.feature_enabled?(:topbar_v1))
    .browse-view-search-form
      - if(main_search == :location)
        = render partial: "location_bar"
      - else
        = render partial: "search_bar"

- content_for(:head) do
  - if seo_pagination_links[:prev].present?
    %link{rel: "prev", href: seo_pagination_links[:prev]}
  - if seo_pagination_links[:next].present?
    %link{rel: "next", href: seo_pagination_links[:next]}

- if @current_community.private? && @big_cover_photo
  - if @community_customization && @community_customization.private_community_homepage_content
    .community-customization-wrapper
      = @community_customization.private_community_homepage_content.html_safe
  - else
    = t(".this_is_private_community")

- else
  .home-toolbar
    .row
      .home-toolbar-filters#home-toolbar-filters
        .filter-button.button.auto-col.mob-visible
          %i.ss-view
          Filters
        %div
        - if listing_shape_menu_enabled
          .auto-col.toggle-container.home-toolbar-toggle-container
            .toggle.with-borders#home_toolbar-select-share-type{data: {toggle: '.home-toolbar-share-type-menu'}}
              .toggle-header-container
                .toggle-header
                  - if selected_shape
                    = t(selected_shape[:name_tr_key])
                  - else
                    = t("homepage.filters.all_listing_types")

                = icon_tag("dropdown", ["icon-dropdown"])

            .home-toolbar-share-type-menu.toggle-menu.hidden
              .filter-width
                = link_to t("homepage.filters.all_listing_types"), search_path(search_params.merge({transaction_type: "all"}))
                - shapes.each do |shape|
                  = link_to search_path(search_params.merge({transaction_type: shape[:name]})), class:  "toggle-menu-subitem" do
                    = t(shape[:name_tr_key])
        

        - if @show_categories
          .auto-col.toggle-container.home-toolbar-toggle-container
            .toggle.with-borders{data: {toggle: '#home-toolbar-categories-menu'}}
              .toggle-header-container
                .toggle-header
                  - if selected_category
                    = selected_category.display_name(I18n.locale)
                  - else
                    = t("homepage.filters.all_categories")

                = icon_tag("dropdown", ["icon-dropdown"])
            #home-toolbar-categories-menu.toggle-menu.hidden.scrollable-categories
              = link_to t("homepage.filters.all_categories"), search_path(search_params.merge({category: "all"}))
              - @main_categories.each do |category|
                = link_to category.display_name(I18n.locale), search_path(search_params.merge({category: category}))
                - if category.children
                  - category.children.each do |child|
                    - is_selected = selected_category == child
                    = link_to child.display_name(I18n.locale), search_path(search_params.merge({category: child})), :class => "toggle-menu-subitem"
          = render :partial => "filters", :locals => { show_price_filter: show_price_filter, show_custom_fields: @show_custom_fields, filters: filters }
        .auto-col.toggle-container.home-toolbar-toggle-container
          = select_tag :sort_order, sorting_options(params[:sort_order])
        .auto-col.filters-enabled.home-toolbar-button-group.mob-visible
          %a.home-toolbar-button-group-button.selected.view-toggle{data: {mode: 'grid-mode'}, href: '#'}
            %i.ss-thumbnails
          %a.home-toolbar-button-group-button.view-toggle{data: {mode: 'list-mode'}, href: '#'}
            %i.ss-list

      .row
        = yield :selected_filters
.row.fixed-homepage
  .map-column
    .home-map
      = render :partial => "map", locals: { viewport: viewport }
  .listings-column
    .row.grid-mode#search-results
      = render partial: 'grid_item_map_content', locals: {show_distance: location_search_in_use, shape_name_map: shape_name_map}

- content_for :extra_javascript do
  :javascript
    $(".view-toggle").click(function(){
      $(".view-toggle").removeClass("selected");
      $(this).addClass("selected");
      $("#search-results").removeClass("grid-mode").removeClass("list-mode").addClass($(this).data("mode"));
      return false;
    });
    $(".home-toolbar-filters#home-toolbar-filters .filter-button").click(function(){
      $(".home-toolbar-filters#home-toolbar-filters .auto-col:not(.mob-visible)").toggle();
      return false;
    });
